// BigScreen v2.0.0 - 2013-01-21 - Apache 2.0 License
(function(e,n,t){"use strict";function r(e){var n=null;if("VIDEO"===e.tagName)n=e;else{var t=e.getElementsByTagName("video");t[0]&&(n=t[0])}return n}function l(e){var n=r(e);if(n&&n.webkitEnterFullscreen){try{n.addEventListener("webkitbeginfullscreen",function t(){n.removeEventListener("webkitbeginfullscreen",t,!1),v.onchange(n),b(n)},!1),n.addEventListener("webkitendfullscreen",function l(){n.removeEventListener("webkitendfullscreen",l,!1),v.onchange(),E()},!1),n.readyState<n.HAVE_METADATA?(n.addEventListener("loadedmetadata",function u(){n.removeEventListener("loadedmetadata",u,!1),n.webkitEnterFullscreen(),d=!!n.getAttribute("controls")},!1),n.load()):(n.webkitEnterFullscreen(),d=!!n.getAttribute("controls")),s=n}catch(i){return g("not_supported",e)}return!0}return g(void 0===a.request?"not_supported":"not_enabled",e)}function u(){v.element||(E(),o())}function i(){t&&"webkitfullscreenchange"===a.change&&e.addEventListener("resize",u,!1)}function o(){t&&"webkitfullscreenchange"===a.change&&e.removeEventListener("resize",u,!1)}var c="undefined"!=typeof Element&&"ALLOW_KEYBOARD_INPUT"in Element,a=function(){for(var e=[{request:"requestFullscreen",exit:"exitFullscreen",enabled:"fullscreenEnabled",element:"fullscreenElement",change:"fullscreenchange",error:"fullscreenerror"},{request:"webkitRequestFullscreen",exit:"webkitExitFullscreen",enabled:"webkitFullscreenEnabled",element:"webkitFullscreenElement",change:"webkitfullscreenchange",error:"webkitfullscreenerror"},{request:"webkitRequestFullScreen",exit:"webkitCancelFullScreen",element:"webkitCurrentFullScreenElement",change:"webkitfullscreenchange",error:"webkitfullscreenerror"},{request:"mozRequestFullScreen",exit:"mozCancelFullScreen",enabled:"mozFullScreenEnabled",element:"mozFullScreenElement",change:"mozfullscreenchange",error:"mozfullscreenerror"}],t=!1,r=n.createElement("video"),l=0;e.length>l;l++)if(e[l].request in r){t=e[l];for(var u in t)"change"===u||"error"===u||t[u]in n||t[u]in r||delete t[u];break}return r=null,t}(),s=null,d=null,m=function(){},f=[],b=function(e){var n=f[f.length-1];(e!==n.element&&e!==s||!n.hasEntered)&&(1===f.length&&v.onenter(v.element),n.enter.call(n.element,e||n.element),n.hasEntered=!0)},E=function(){s&&!d&&(s.setAttribute("controls","controls"),s.removeAttribute("controls")),s=null,d=null;var e=f.pop();e&&(e.exit.call(e.element),v.element||(f.forEach(function(e){e.exit.call(e.element)}),f=[],v.onexit()))},g=function(e,n){if(f.length>0){var t=f.pop();n=n||t.element,t.error.call(n,e),v.onerror(n,e)}},v={request:function(e,r,u,i){if(e=e||n.documentElement,f.push({element:e,enter:r||m,exit:u||m,error:i||m}),void 0===a.request)return l(e);if(t&&n[a.enabled]===!1)return l(e);if(t&&void 0===a.enabled)return a.enabled="webkitFullscreenEnabled",e[a.request](),setTimeout(function(){n[a.element]?n[a.enabled]=!0:(n[a.enabled]=!1,l(e))},250),void 0;try{/5\.1[\.\d]* Safari/.test(navigator.userAgent)?e[a.request]():e[a.request](c&&Element.ALLOW_KEYBOARD_INPUT),setTimeout(function(){n[a.element]||g(t?"not_enabled":"not_allowed",e)},100)}catch(o){g("not_enabled",e)}},exit:function(){o(),n[a.exit]()},toggle:function(e,n,t,r){v.element?v.exit():v.request(e,n,t,r)},videoEnabled:function(e){if(v.enabled)return!0;e=e||n.documentElement;var t=r(e);return t&&void 0!==t.webkitSupportsFullscreen?t.readyState<t.HAVE_METADATA?"maybe":t.webkitSupportsFullscreen:!1},onenter:m,onexit:m,onchange:m,onerror:m};try{Object.defineProperties(v,{element:{enumerable:!0,get:function(){return s&&s.webkitDisplayingFullscreen?s:n[a.element]||null}},enabled:{enumerable:!0,get:function(){return"webkitCancelFullScreen"!==a.exit||t?n[a.enabled]||!1:!0}}})}catch(h){v.element=null,v.enabled=!1}a.change&&n.addEventListener(a.change,function(){if(v.onchange(v.element),v.element){var e=f[f.length-2];e&&e.element===v.element?E():(b(v.element),i())}else E()},!1),a.error&&n.addEventListener(a.error,function(){g("not_allowed")},!1),e.BigScreen=v})(window,document,self!==top);